---
title: "NADM1 Data Cleaning"
author: "Daniel O'Leary"
date: "January 29, 2019"
output: 
  github_document:
    toc: true
---

# Setup

## Load Packages
```{r setup, include=FALSE}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
  tidyverse, 
  haven, 
  lubridate,
  survival, survminer, simPH, effects
)
```


## Load Data
```{r}
subids <-
  read_csv("G:/My Drive/research/projects/nadm1/nadm1_data/nadm1_ssdm2_subids.csv")

redcap <-
  read_csv("G:/My Drive/research/projects/nadm1/nadm1_data/nadm1_redcap_data/nadm1_ema_01_29_1905.csv")

asa_24 <-
  read_csv("G:/My Drive/research/projects/nadm1/nadm1_data/nadm1_asa24_data/nadm1_2019-01-30_80657/nadm1_2019-01-30_80657_TNS.csv")

asa_24_total <-
  read_csv("G:/My Drive/research/projects/nadm1/nadm1_data/nadm1_asa24_data/nadm1_2019-01-30_80657/nadm1_2019-01-30_80657_Totals.csv")

# ssdm2_survey_data <-
#   ssdm2_survey_data %>% 
#   left_join(
#     ssdm2_mcq,
#     by = "subid"
#   )
ssdm2_survey_data_nadm <- read_csv("G:/My Drive/research/projects/ssdm2/ssdm2_group_data/ssdm2_survey_data_new.csv")


# UPDATE THESE
# c_df_nadm <- read_csv("G:/My Drive/research/projects/ssdm2/ssdm2_group_data/ssdm2_choices_survey.csv")
# r_df_nadm <- read_csv("G:/My Drive/research/projects/ssdm2/ssdm2_group_data/ssdm2_ratings_survey.csv")
```


```{r}
asa_24_total %>% 
  dplyr::select(
    ses_comp_all,
    ses_subj1,
    ladd_comm,
    ladd_us,
    KCAL:A_DRINKS
  ) %>% 
  filter_all(
    all_vars(!is.na(.))
  ) %>% 
  cor()
```

```{r}
# ASA 24 by day

asas_24_by_day <-
  asa_24_total %>% 
  dplyr::select(
    subid = ssdm2_subid,
    day = ReportingDate,
    KCAL:A_DRINKS
  ) %>% 
  gather(food, amt, KCAL:A_DRINKS) %>% 
  group_by(subid, day, food) %>% 
  summarise(
    mean = mean(amt, na.rm = TRUE),
    sd = sd(amt, na.rm = TRUE)
  )

asa_24_avg <-
  asa_24_total %>% 
  dplyr::select(
    subid = ssdm2_subid,
    KCAL:A_DRINKS
  ) %>% 
  gather(food, amt, KCAL:A_DRINKS) %>% 
  group_by(subid, food) %>% 
  summarise(
    mean = mean(amt, na.rm = TRUE),
    #sd = sd(amt, na.rm = TRUE)
  )  %>% 
  ungroup() %>% 
  spread(food, mean)

asa_24_avg <-
  asa_24_avg %>% 
  mutate(subid = as.numeric(subid)) %>% 
  left_join(
    ssdm2_survey_data_nadm,
    by = "subid"
  )
```

```{r}

```


```{r}
lm1 <-
  lm(
    ADD_SUGARS ~
      panas_neg,
    data = asa_24_avg
  )

summary(lm1)
```




```{r}
cal_stress <-
  asa_24_total %>% 
  group_by(redcap_record_id, RecallNo) %>% 
  summarise(
    mean_v = mean(V_TOTAL, na.rm = TRUE)
  ) %>% 
  mutate(day = RecallNo) %>% 
  left_join(
    redcap_ema %>% 
      group_by(redcap_record_id, day) %>% 
      summarise(
        mean_stress = mean(stress, na.rm = TRUE),
        mean_worried = mean(worried, na.rm = TRUE)
      ) %>% 
      mutate(
        day = as.integer(str_extract(day, "\\d"))
      ),
    by = c("redcap_record_id","day")
  )

summary(lmer(mean_v ~ mean_stress + (1|redcap_record_id), data = cal_stress))

summary(lmer(V_TOTAL ~ gen_eating_15 + (1|ssdm2_subid), data = asa_24_total))
```

```{r}
asa_24_total <-
  asa_24_total %>% 
  left_join(
    rating_lm_betas,
    by = "subid"
  )

summary(lmer(FIBE ~ health_lm_beta + taste_lm_beta + (1|ssdm2_subid), data = asa_24_total))
summary(lmer(V_TOTAL ~ health_lm_beta + taste_lm_beta + (1|ssdm2_subid), data = asa_24_total))
summary(lmer(ADD_SUGARS ~ health_lm_beta + taste_lm_beta + (1|ssdm2_subid), data = asa_24_total))
summary(lmer(G_REFINED ~ health_lm_beta + taste_lm_beta + (1|ssdm2_subid), data = asa_24_total))
summary(lmer(F_TOTAL ~ health_lm_beta + taste_lm_beta + (1|ssdm2_subid), data = asa_24_total))
summary(lmer(SUGR ~ health_lm_beta + taste_lm_beta + (1|ssdm2_subid), data = asa_24_total))
summary(lmer(SOLID_FATS ~ health_lm_beta + taste_lm_beta + (1|ssdm2_subid), data = asa_24_total))

```

